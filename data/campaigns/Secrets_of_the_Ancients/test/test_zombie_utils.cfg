{GENERIC_UNIT_TEST "sota_zombie_list_save_load" (
    # This expands to an [event]name=prestart
    {ZOMBIE_INIT}

    [event]
        name = start
        {ASSERT ({VARIABLE_CONDITIONAL zombies[0].allow_recruit boolean_equals no})}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[1].allow_recruit boolean_equals no})}
        {SAVE_ZOMBIE_LIST no_recruits}

        {VARIABLE zombies[0].allow_recruit yes}
        {SAVE_ZOMBIE_LIST recruit_zeroth}

        {LOAD_ZOMBIE_LIST no_recruits}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[0].allow_recruit boolean_equals no})}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[1].allow_recruit boolean_equals no})}

        {VARIABLE zombies[1].allow_recruit yes}
        {SAVE_ZOMBIE_LIST recruit_first}

        {LOAD_ZOMBIE_LIST recruit_zeroth}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[0].allow_recruit boolean_equals yes})}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[1].allow_recruit boolean_equals no})}

        {LOAD_ZOMBIE_LIST recruit_first}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[0].allow_recruit boolean_equals no})}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[1].allow_recruit boolean_equals yes})}

        {LOAD_ZOMBIE_LIST no_recruits}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[0].allow_recruit boolean_equals no})}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[1].allow_recruit boolean_equals no})}

        {LOAD_ZOMBIE_LIST recruit_zeroth}
        {MERGE_ZOMBIE_LIST recruit_first}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[0].allow_recruit boolean_equals yes})}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[1].allow_recruit boolean_equals yes})}

        {LOAD_ZOMBIE_LIST recruit_first}
        {MERGE_ZOMBIE_LIST recruit_zeroth}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[0].allow_recruit boolean_equals yes})}
        {ASSERT ({VARIABLE_CONDITIONAL zombies[1].allow_recruit boolean_equals yes})}

        {SUCCEED}
    [/event]
)}
